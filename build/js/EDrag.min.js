!function(n){function t(n){this.opt=n,this.init(n),this.isDown=!1}window.qs=function(n){return document.querySelector(n)},window.tplId=(new Date).getTime().toString().substr(8),t.prototype={init:function(n){this.el=n.el,this.$el=$(n.el),n.moveOnly?this.dragMoveOnly():this.drag(),this.$el.css("cursor","move")},drag:function(){var n=this;this.$el.on("mousedown",function(t){var e=n.$el;n.isDown=!0;var i={x:this.offsetLeft,y:this.offsetTop},o=t.clientX-i.x,s=t.clientY-i.y;n.watchMousePs(function(n){var t={x:n.x-o,y:n.y-s};e.css({position:"absolute",top:t.y,left:t.x}),e.addClass("no-select")})}),this.$el.on("mouseup",function(){n.isDown=!1,$(".dr-tpl").remove(),$(this).removeClass("no-select")}),n.opt.callback&&n.opt.callback()},dragMoveOnly:function(){var n=this;this.$el.on("mouseenter",function(t){var e=n.$el;n.isDown=!0;var i={x:this.offsetLeft,y:this.offsetTop},o=t.clientX-i.x,s=t.clientY-i.y;n.watchMousePs(function(t){var i={x:t.x-o,y:t.y-s};e.css({position:"absolute",top:i.y,left:i.x}),e.addClass("no-select"),n.opt.callback&&n.opt.callback(i)})}),this.$el.on("mouseup",function(){n.isDown=!1,$(".dr-tpl").remove(),$(this).removeClass("no-select")})},$error:function(n){console.log(n)},watchMousePs:function(n){var t=this;document.addEventListener("mousemove",function(e){var i={x:e.clientX,y:e.clientY};n&&t.isDown&&n(i)})}};var e=function(n){this.opt=n,this.draging=!1,this.dragObj=[],this.isInner=[],this.bind=[],this.isNewObj=!1,this.tplId=(new Date).getTime().toString().substr(8),this.init(n)};e.prototype={init:function(n){var e=this;this.bind=n.bind;for(var i in this.bind)e.bind[i].template?e.dragTemplate(e.bind[i],i):e.dragObj.push(new t(e.bind[i]));n.showMousePs&&this.mousePs(),"container"in n&&(n.container&&"string"==typeof n.container||this.$error("container必须是string类型"))},mousePs:function(){var n={x:0,y:0},e={x:0,y:0},i='<div class="mouse-position"><div class="deng"></div><p>鼠标位置</p><p>x: <span class="m-x"></span></p><p>y: <span class="m-y"></span></p></div>';$("body").append(i),document.addEventListener("mousemove",function(t){qs(".m-x").innerHTML=t.clientX,qs(".m-y").innerHTML=t.clientY,n.x=t.clientX,n.y=t.clientY,qs(".deng").style.background="#0db893"}),setInterval(function(){e.x===n.x&&e.y===n.y?qs(".deng").style.background="#EB5449":e=n},500);new t({el:".mouse-position"})},dragTemplate:function(n,e){var i=this,o=$(n.el),s=n.template,r=this.opt;this.isInner[e]={inner:!1,get $inner(){try{return $inner}catch(n){return!1}},set $inner(n){n!==i.isInner[e].$inner&&($inner=n,$inner?(console.log("项目"+e+"入境"),i.inLayout(r.container,i.bind[e])):(console.log("项目"+e+"出境"),i.outLayout(r.container,i.bind[e])))}},o.on("mousedown",function(n){i.draging=!0,i.isNewObj=!0;var o='<div class="dr-tpl" style="position: absolute">'+s+"</div>";$("body").append(o),$(".dr-tpl").css({top:n.clientY-50,left:n.clientX-50});new t({el:".dr-tpl",moveOnly:!0,callback:function(n){if(i.opt.container){var t=qs(i.opt.container),o=t.offsetLeft,s=t.offsetLeft+t.offsetWidth,r=t.offsetTop,c=t.offsetHeight+t.offsetTop;n.x<s&&n.x>o&&n.y<c&&n.y>r?i.isInner[e].$inner=!0:i.isInner[e].$inner=!1}}})})},inLayout:function(n,t){var e=$(n),i=this,o=this.tplId,s='<div class="dr-row dr-placeholder dr-'+o+'"></div><div class="dr-row dr-bd dr-'+o+'" id="'+o+'" style="display: none">'+t.template+'</div><div class="dr-gap dr-'+o+'"></div>';e.append(s),$(document).on("mouseup",function(){console.log("鼠标放开"),$(".dr-placeholder").remove(),$(".dr-"+o).show(),i.tplId=(new Date).getTime().toString().substr(8)})},outLayout:function(n,t){var e=($(n),".dr-"+this.tplId);$(e).remove()},changePosition:function(){qs(this.opt.container).addEventListener("mousedown",function(n){})},$error:function(n){console.log(n)}},"function"==typeof define&&(define.amd||define.cmd)?define("EDrag",["jQuery"],function(){return e}):window.EDrag=e,"function"==typeof define&&(define.amd||define.cmd)?define("BaseDrag",["jQuery"],function(){return t}):window.BaseDrag=t}(this);